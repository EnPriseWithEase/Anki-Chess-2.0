<script>
    // User Variables
    var muteAudio = false // set true to disable sound
    var flip = false; // sets whether Puzzle begins from First (false) or second (true) move of PGN
    var fontSize = 18; // control font size for userText field in px

    // v1.0.0 - https://github.com/SimonLammer/anki-persistence/blob/cd2ca88e019dc3b8f32dad623932c1eabdba7e21/script.js
    if(void 0===window.Persistence){var _persistenceKey="github.com/SimonLammer/anki-persistence/",_defaultKey="_default";if(window.Persistence_sessionStorage=function(){var e=!1;try{"object"==typeof window.sessionStorage&&(e=!0,this.clear=function(){for(var e=0;e<sessionStorage.length;e++){var t=sessionStorage.key(e);0==t.indexOf(_persistenceKey)&&(sessionStorage.removeItem(t),e--)}},this.setItem=function(e,t){null==t&&(t=e,e=_defaultKey),sessionStorage.setItem(_persistenceKey+e,JSON.stringify(t))},this.getItem=function(e){return null==e&&(e=_defaultKey),JSON.parse(sessionStorage.getItem(_persistenceKey+e))},this.removeItem=function(e){null==e&&(e=_defaultKey),sessionStorage.removeItem(_persistenceKey+e)})}catch(e){}this.isAvailable=function(){return e}},window.Persistence_windowKey=function(e){var t=window[e],n=!1;"object"==typeof t&&(n=!0,this.clear=function(){t[_persistenceKey]={}},this.setItem=function(e,n){null==n&&(n=e,e=_defaultKey),t[_persistenceKey][e]=n},this.getItem=function(e){return null==e&&(e=_defaultKey),null==t[_persistenceKey][e]?null:t[_persistenceKey][e]},this.removeItem=function(e){null==e&&(e=_defaultKey),delete t[_persistenceKey][e]},null==t[_persistenceKey]&&this.clear()),this.isAvailable=function(){return n}},window.Persistence=new Persistence_sessionStorage,Persistence.isAvailable()||(window.Persistence=new Persistence_windowKey("py")),!Persistence.isAvailable()){var titleStartIndex=window.location.toString().indexOf("title"),titleContentIndex=window.location.toString().indexOf("main",titleStartIndex);titleStartIndex>0&&titleContentIndex>0&&titleContentIndex-titleStartIndex<10&&(window.Persistence=new Persistence_windowKey("qt"))}}
</script>

<iframe id="analysisBoard" style="visibility: hidden"></iframe>

<script data-name="injectScript" data-version="v0.1">
    var background = window.getComputedStyle( document.body ,null).getPropertyValue('background-color');
    {{#textField}}
    // optional user text
    var userText = `{{textField}}`
    userText = encodeURIComponent(userText)
    {{/textField}}

        var errorCheck
        if (Persistence.isAvailable()) {
            errorTrack = Persistence.getItem("errorTrack");
            Persistence.clear();
        }
</script>

<script>
    var PGNtext = `{{text:PGN}}`.replace("[%eval", "[ %eval");
    var PGN = encodeURIComponent(PGNtext);
    var iframe = document.getElementById("analysisBoard");
    iframe.onload = function() { iframe.style.visibility = "visible"; }
    iframe.src = `_chess3.0.html?{{#textField}}userText=` + userText + `&{{/textField}}PGN=` + PGN + `&flip=`+flip+`&background=`+background+`&fontSize=`+fontSize+`&boardMode=Viewer&muteAudio=`+muteAudio+`&errorTrack=`+errorTrack+``;
</script>